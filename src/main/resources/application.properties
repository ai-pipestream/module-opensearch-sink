quarkus.application.name=opensearch

# Production port allocation
quarkus.http.port=39004
quarkus.http.host=0.0.0.0
quarkus.grpc.server.use-separate-server=false

# Development override
%dev.quarkus.http.port=39104
%dev.quarkus.http.host=0.0.0.0


# Test profile uses OpensearchContainerTestResource (pipestream-test-support) for OpenSearch
# Compose devservices disabled; Testcontainers provides OpenSearch
%test.quarkus.compose.devservices.enabled=false

# gRPC Client pointing to registration service via Stork
# Prod/Dev: Consul discovery (host=service-name)
# Test: host:port via WireMock resource (dynamic-grpc bypasses Consul)
quarkus.grpc.clients.registration-service.host=registration-service
quarkus.grpc.clients.registration-service.name-resolver=stork

# gRPC Client for the opensearch-manager service (for indexing operations)
quarkus.grpc.clients.opensearch-manager.host=opensearch-manager
quarkus.grpc.clients.opensearch-manager.name-resolver=stork

# gRPC Client for the opensearch-sink service (used by REST endpoints)
quarkus.grpc.clients.opensearchSink.host=localhost
quarkus.grpc.clients.opensearchSink.port=39104

# Stork service discovery configuration
quarkus.stork.registration-service.service-discovery.type=consul
quarkus.stork.registration-service.service-discovery.consul-host=${CONSUL_HOST:consul}
quarkus.stork.registration-service.service-discovery.consul-port=${CONSUL_PORT:8500}

# Stork service discovery for opensearch-manager
quarkus.stork.opensearch-manager.service-discovery.type=consul
quarkus.stork.opensearch-manager.service-discovery.consul-host=${CONSUL_HOST:consul}
quarkus.stork.opensearch-manager.service-discovery.consul-port=${CONSUL_PORT:8500}

# Development override - use localhost Consul in dev mode
%dev.quarkus.stork.registration-service.service-discovery.consul-host=localhost
%dev.quarkus.stork.opensearch-manager.service-discovery.consul-host=localhost

# Pipestream Service Registration Configuration
pipestream.server.class=module
pipestream.registration.enabled=true
pipestream.registration.service-name=opensearch-sink
pipestream.registration.type=MODULE
pipestream.registration.description=OpenSearch vector indexing sink with dynamic schema creation and distributed locking
pipestream.registration.capabilities=vector-indexing,opensearch,dynamic-schema,distributed-locking,sink
pipestream.registration.tags=opensearch,sink,vector,indexing,module

# Disable for tests
%test.pipestream.registration.enabled=false

# Module configuration
module.name=opensearch
module.type=sink
module.description=OpenSearch vector indexing sink with dynamic schema creation

# Enable gRPC reflection service for production (enabled by default in dev)
quarkus.grpc.server.enable-reflection-service=true

# Health check configuration - use localhost for local development
module.health.check.host=localhost

# gRPC Message Size Configuration (2GB - 1 byte, max int value)
quarkus.grpc.server.max-inbound-message-size=2147483647
quarkus.grpc.clients.opensearchSink.max-inbound-message-size=2147483647

# Logging Configuration - reduce noise
quarkus.log.level=INFO
quarkus.log.category."ai.pipestream".level=DEBUG
quarkus.log.category."io.vertx.ext.consul".level=WARN
quarkus.log.category."io.quarkus.grpc".level=WARN

# JVM Memory settings for large message processing
quarkus.native.additional-build-args=-J-Xmx4g
%dev.quarkus.devservices.timeout=120s

# Context path: module under /modules/<name> (parser is reference)
quarkus.http.root-path=/modules/opensearch-sink

# Test settings - use random port to avoid conflicts
%test.quarkus.http.port=0
%test.quarkus.http.test-port=0

# Processing buffer configuration (for interceptor testing)
processing.buffer.enabled=false
processing.buffer.capacity=100
processing.buffer.directory=target/test-data
processing.buffer.prefix=opensearch-sink

# Enable buffer in dev mode for testing
%dev.processing.buffer.enabled=true

# OpenSearch Configuration
# Dev/prod use env vars or compose; test profile relies on DevServices
%dev.opensearch.hosts=${OPENSEARCH_HOST:localhost}:${OPENSEARCH_PORT:9200}
%prod.opensearch.hosts=${OPENSEARCH_HOST:localhost}:${OPENSEARCH_PORT:9200}
%dev.opensearch.protocol=http
%prod.opensearch.protocol=http
%dev.opensearch.username=${OPENSEARCH_USERNAME:}
%prod.opensearch.username=${OPENSEARCH_USERNAME:}
%dev.opensearch.password=${OPENSEARCH_PASSWORD:}
%prod.opensearch.password=${OPENSEARCH_PASSWORD:}
opensearch.connection-timeout=5000
opensearch.socket-timeout=10000
opensearch.max-connections=20
opensearch.ssl-verify=false
opensearch.ssl-verify-hostname=false

# Test profile OpenSearch configuration (OpensearchContainerTestResource overrides hosts)
%test.opensearch.protocol=http
# Disable opensearch-manager in tests; dimension derived from document embeddings
%test.opensearch.sink.use-opensearch-manager=false

# Sink-specific index settings (vector dimensions are dynamic - from opensearch-manager or document)
opensearch.sink.index-prefix=documents
opensearch.sink.vector-algorithm=hnsw
opensearch.sink.vector-space-type=cosine

# Test profile configuration
%test.quarkus.devservices.enabled=true
